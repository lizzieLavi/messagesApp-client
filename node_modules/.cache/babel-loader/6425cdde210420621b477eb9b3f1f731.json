{"ast":null,"code":"import _objectSpread from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import axios from'axios';import{useSocket}from\"./socketprovider\";import{jsx as _jsx}from\"react/jsx-runtime\";var UserContext=/*#__PURE__*/React.createContext();export function useUser(){return useContext(UserContext);}export function UserProvider(_ref){var children=_ref.children;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),contacts=_useState2[0],setContacts=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),info=_useState4[0],setInfo=_useState4[1];var config={'headers':{'x-access-token':sessionStorage['config']}};var _useSocket=useSocket(),socket=_useSocket.socket;var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),updateFlag=_useState6[0],setUpdateFlag=_useState6[1];useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:getContacts().then(function(res){return setContacts(res);});case 1:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}if(updateFlag){fetchData();setUpdateFlag(false);}},[updateFlag]);useEffect(function(){function fetchData(){return _fetchData2.apply(this,arguments);}function _fetchData2(){_fetchData2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(socket.current==null)){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2://when other user updates contact information, update this user on changes\nsocket.current.on('update-contact',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setUpdateFlag(true);case 1:case\"end\":return _context2.stop();}}},_callee2);})));case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _fetchData2.apply(this,arguments);}fetchData();},[updateFlag]);function getContacts(){return _getContacts.apply(this,arguments);}function _getContacts(){_getContacts=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var response;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/\"+sessionStorage['id'],config);case 2:response=_context6.sent;setInfo({id:response.data._id,name:response.data.name,phone:response.data.phone,imageName:response.data.imageName,LastSeen:response.data.LastSeen,Status:response.data.Status,color:response.data.color});console.log(response.data.contacts);return _context6.abrupt(\"return\",response.data.contacts);case 6:case\"end\":return _context6.stop();}}},_callee6);}));return _getContacts.apply(this,arguments);}function getSearchContacts(str){getContacts().then(function(res){var SearchResult=res.filter(function(contact){return contact.name.includes(str)===true;});setContacts(SearchResult);});}var createContact=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(name){var checkIfExists,response,contact,newContacts,UpdatedUser;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(name===info.name)){_context4.next=2;break;}return _context4.abrupt(\"return\",{status:'error',message:'cant Add yourself'});case 2:checkIfExists=contacts.filter(function(contact){return contact.name===name;});if(!(checkIfExists.length!==0)){_context4.next=5;break;}return _context4.abrupt(\"return\",{status:'error',message:'already exists'});case 5:_context4.prev=5;_context4.next=8;return axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/getByName/\"+name,config);case 8:response=_context4.sent;if(!(response.data!=='no such user')){_context4.next=24;break;}contact={id:response.data._id,phone:response.data.phone,name:response.data.name,imageName:response.data.imageName,Status:response.data.Status,color:response.data.color};newContacts=[].concat(_toConsumableArray(contacts),[contact]);setContacts(newContacts);UpdatedUser=_objectSpread(_objectSpread({},info),{},{contacts:newContacts});_context4.prev=14;_context4.next=17;return axios.put(\"https://messagesapp1.herokuapp.com/api/logIn/\"+sessionStorage['id'],UpdatedUser,{'headers':{'x-access-token':sessionStorage['config']}});case 17:_context4.next=22;break;case 19:_context4.prev=19;_context4.t0=_context4[\"catch\"](14);console.log(_context4.t0);case 22:_context4.next=25;break;case 24:return _context4.abrupt(\"return\",{status:'error',message:'user doesnt exist'});case 25:_context4.next=30;break;case 27:_context4.prev=27;_context4.t1=_context4[\"catch\"](5);console.log(_context4.t1);case 30:return _context4.abrupt(\"return\",{status:'ok'});case 31:case\"end\":return _context4.stop();}}},_callee4,null,[[5,27],[14,19]]);}));return function createContact(_x){return _ref3.apply(this,arguments);};}();var updateInformation=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(user,userToContacts){var response;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return axios.put(\"https://messagesapp1.herokuapp.com/api/logIn/\"+sessionStorage['id'],user,config);case 3:response=_context5.sent;if(response.data.status==='Updated'){setInfo(user);}_context5.next=10;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 10:socket.current.emit('contact-changed',userToContacts);case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function updateInformation(_x2,_x3){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsx(UserContext.Provider,{value:{setContacts:setContacts,setInfo:setInfo,info:info,config:config,contacts:contacts,createContact:createContact,getSearchContacts:getSearchContacts,updateInformation:updateInformation},children:children});}","map":{"version":3,"sources":["C:/Users/User/OneDrive/Desktop/whatsapp/myclient/src/contexts/userprovider.js"],"names":["React","useState","useEffect","useContext","axios","useSocket","UserContext","createContext","useUser","UserProvider","children","contacts","setContacts","info","setInfo","config","sessionStorage","socket","updateFlag","setUpdateFlag","fetchData","getContacts","then","res","current","on","get","response","id","data","_id","name","phone","imageName","LastSeen","Status","color","console","log","getSearchContacts","str","SearchResult","filter","contact","includes","createContact","status","message","checkIfExists","length","newContacts","UpdatedUser","put","updateInformation","user","userToContacts","emit"],"mappings":"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","sourcesContent":["\r\nimport React, { useState ,useEffect, useContext} from 'react'\r\nimport axios from 'axios'\r\nimport { useSocket } from \"./socketprovider\";\r\nconst UserContext = React.createContext()\r\n\r\n\r\nexport function useUser() \r\n{\r\n  return useContext(UserContext)\r\n}\r\n\r\nexport  function UserProvider({ children })\r\n{\r\n  const [contacts, setContacts] = useState([])\r\n  const [info,setInfo] =useState({})\r\n  const config= {'headers': {'x-access-token':sessionStorage['config']}}\r\n  const {socket} = useSocket();\r\n  const [updateFlag,setUpdateFlag]=useState(true)\r\n\r\n  \r\n  useEffect( () =>\r\n  {\r\n    async function fetchData() \r\n    {\r\n      getContacts().then(res=> setContacts(res))\r\n    }\r\n\r\n    if(updateFlag)\r\n    {\r\n      fetchData();\r\n      setUpdateFlag(false)\r\n    }\r\n\r\n   },[updateFlag])\r\n\r\n   useEffect(()=>\r\n   {\r\n     async function fetchData() \r\n     {\r\n       if(socket.current ==null ) return;\r\n\r\n \r\n       //when other user updates contact information, update this user on changes\r\n       socket.current.on('update-contact',async ()=>\r\n       {\r\n         setUpdateFlag(true)\r\n       })\r\n \r\n   }\r\n \r\n   fetchData();\r\n \r\n   },[updateFlag])\r\n\r\n   async function getContacts()\r\n   {\r\n      const response = await axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/\"+sessionStorage['id'],config);\r\n      setInfo({id:response.data._id,name:response.data.name,phone:response.data.phone,imageName:response.data.imageName,LastSeen:response.data.LastSeen,Status:response.data.Status,color:response.data.color})\r\n      console.log(response.data.contacts)\r\n      return(response.data.contacts)\r\n\r\n   }\r\n   \r\n\r\n  function getSearchContacts(str)\r\n  {\r\n    getContacts().then(res=>\r\n    {\r\n      let SearchResult =res.filter(contact=> contact.name.includes(str) === true)\r\n      setContacts(SearchResult)\r\n    })\r\n\r\n  }\r\n\r\n\r\n  const createContact = async(name) =>\r\n  {\r\n    \r\n    if(name === info.name)\r\n    {\r\n      return {status:'error',message:'cant Add yourself'};\r\n    }\r\n\r\n    let checkIfExists = contacts.filter(contact=> contact.name === name)\r\n\r\n    if(checkIfExists.length !== 0)\r\n    {\r\n      return {status:'error',message:'already exists'};\r\n    }\r\n\r\n    try\r\n    { \r\n\r\n      const response= await axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/getByName/\" + name,config)\r\n\r\n      if(response.data !== 'no such user')\r\n      {\r\n        const contact = {id:response.data._id,phone:response.data.phone,name:response.data.name,imageName:response.data.imageName,Status:response.data.Status,color:response.data.color}\r\n        let newContacts = [...contacts,contact]\r\n        setContacts(newContacts)\r\n        let UpdatedUser={...info,contacts:newContacts}\r\n        try\r\n        {\r\n          await axios.put(\"https://messagesapp1.herokuapp.com/api/logIn/\" + sessionStorage['id'],UpdatedUser,{'headers': {'x-access-token':sessionStorage['config']}})\r\n        } catch(err){console.log(err)}\r\n      }\r\n      else return {status:'error',message:'user doesnt exist'};\r\n     \r\n    }catch(err){console.log(err)}\r\n\r\n    return {status:'ok'}\r\n\r\n  }\r\n\r\n  const updateInformation = async(user,userToContacts) =>\r\n  {\r\n    try\r\n    {\r\n      let response = await axios.put(\"https://messagesapp1.herokuapp.com/api/logIn/\" + sessionStorage['id'],user,config)\r\n      if(response.data.status==='Updated')\r\n      {\r\n        setInfo(user)\r\n      }\r\n    }catch(err){console.log(err)}\r\n\r\n     socket.current.emit('contact-changed',userToContacts)\r\n  }\r\n\r\n\r\n\r\n  return (\r\n    <UserContext.Provider value={{setContacts,setInfo,info,config,contacts,createContact,getSearchContacts,updateInformation }}>\r\n      {children}\r\n    </UserContext.Provider>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}