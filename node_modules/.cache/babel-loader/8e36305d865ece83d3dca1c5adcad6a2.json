{"ast":null,"code":"import _toConsumableArray from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/User/OneDrive/Desktop/whatsapp/myclient/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useCallback,useRef}from\"react\";import{useState,useEffect}from\"react\";import{useUser}from\"./userprovider\";import{useSocket}from\"./socketprovider\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";var ConversationsContext=/*#__PURE__*/React.createContext();export function useConversations(){return useContext(ConversationsContext);}export function ConversationsProvider(_ref){var id=_ref.id,children=_ref.children;var _useUser=useUser(),contacts=_useUser.contacts,info=_useUser.info;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),conversations=_useState2[0],setConversations=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),selectedConversation=_useState4[0],setSelectedConversation=_useState4[1];var RefConversations=useRef(conversations);var currentConversationRef=useRef(selectedConversation);var _useSocket=useSocket(),socket=_useSocket.socket,ConnectedUsers=_useSocket.ConnectedUsers;var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),typingFlag=_useState6[0],setTypingFlag=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),currentConversationIsConnected=_useState8[0],setCurrentConversationIsConnected=_useState8[1];var config={headers:{\"x-access-token\":sessionStorage[\"config\"]}};var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showDetails=_useState10[0],setShowDetails=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),removedFromGroupFlag=_useState12[0],setRemovedFromGroupFlag=_useState12[1];var audio=new Audio('https://res.cloudinary.com/dsrgpqnyv/video/upload/v1630680168/juntos-607_qsfc7i.mp3');useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(socket.current==null)){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:socket.current.on('user-typing',function(_ref2){var user=_ref2.user,conversationId=_ref2.conversationId;if(selectedConversation){if(selectedConversation._id===conversationId){setTypingFlag(user.name);}}});socket.current.on('update-conversation',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:getConversations().then(function(res){return setConversations(res);});case 1:case\"end\":return _context.stop();}}},_callee);})));socket.current.on('removed-user',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:getConversations().then(function(res){setConversations(res);if(selectedConversation){var checkIfDeleted=res.filter(function(conversation){return conversation._id===selectedConversation._id;});if(checkIfDeleted.length==0)setRemovedFromGroupFlag(true);}});case 1:case\"end\":return _context2.stop();}}},_callee2);})));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _fetchData.apply(this,arguments);}fetchData();},[selectedConversation]);useEffect(function(){function fetchData(){return _fetchData2.apply(this,arguments);}function _fetchData2(){_fetchData2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!selectedConversation){_context4.next=10;break;}if(selectedConversation.isGroup){_context4.next=10;break;}if(!ConnectedUsers.some(function(user){return user.userId===selectedConversation.Participants[0].id;})){_context4.next=6;break;}setCurrentConversationIsConnected('');_context4.next=10;break;case 6:_context4.next=8;return axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/\"+selectedConversation.Participants[0].id,config);case 8:response=_context4.sent;setCurrentConversationIsConnected(response.data.LastSeen);case 10:case\"end\":return _context4.stop();}}},_callee4);}));return _fetchData2.apply(this,arguments);}fetchData();},[ConnectedUsers,selectedConversation]);useEffect(function(){function fetchData(){return _fetchData3.apply(this,arguments);}function _fetchData3(){_fetchData3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:getConversations().then(function(res){return setConversations(res);});case 1:case\"end\":return _context5.stop();}}},_callee5);}));return _fetchData3.apply(this,arguments);}fetchData();},[]);function getConversations(){return _getConversations.apply(this,arguments);}function _getConversations(){_getConversations=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var response,ConversationsList;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.prev=0;_context7.next=3;return axios.get(\"https://messagesapp1.herokuapp.com/api/conversations/UserConversations/\"+sessionStorage[\"id\"],config);case 3:response=_context7.sent;ConversationsList=response.data.map(function(conversation){var UpdatedConversation=conversation;if(!conversation.Participants.isGroup&&conversation.Name===sessionStorage[\"name\"])UpdatedConversation=_objectSpread(_objectSpread({},UpdatedConversation),{},{Name:conversation.Participants[0].name,ConversationImage:conversation.Participants[0].image});if(selectedConversation){if(selectedConversation._id===UpdatedConversation._id)setSelectedConversation(UpdatedConversation);}return UpdatedConversation;});return _context7.abrupt(\"return\",ConversationsList);case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](0);console.log(_context7.t0);case 11:case\"end\":return _context7.stop();}}},_callee7,null,[[0,8]]);}));return _getConversations.apply(this,arguments);}function getSearchConverastions(_x){return _getSearchConverastions.apply(this,arguments);}function _getSearchConverastions(){_getSearchConverastions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(str){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:getConversations().then(function(res){var SearchResult=res.filter(function(conversation){return conversation.Name.includes(str)===true;});setConversations(SearchResult);});case 1:case\"end\":return _context8.stop();}}},_callee8);}));return _getSearchConverastions.apply(this,arguments);}function createConversation(_x2,_x3,_x4,_x5){return _createConversation.apply(this,arguments);}function _createConversation(){_createConversation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(ids,name,image,groupFlag){var ConversationImage,isGroup,ConversationExists,participants,createdDate,parts,data,response,newConversation,Response;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:ConversationImage=image;isGroup=groupFlag;//no participants chosen\nif(!(ids.length===0)){_context9.next=4;break;}return _context9.abrupt(\"return\",{status:'error',message:'no participants choosen'});case 4://check if conversation already exists and it's not a group\nConversationExists=null;if(ids.length===1&&!isGroup){ConversationExists=conversations.find(function(conversation){return conversation.Name===name;});}if(!ConversationExists){_context9.next=10;break;}setSelectedConversation(ConversationExists);//create new conversation\n_context9.next=42;break;case 10://get conversation participants\nparticipants=ids.map(function(id){var addContactToConversation=contacts.filter(function(contact){return id===contact.id;});return addContactToConversation[0];});//add creator to participants\nparticipants.push({id:info.id,name:info.name,phone:info.phone,imageName:info.imageName,LastSeen:info.LastSeen});createdDate='';//if group\nif(!isGroup){_context9.next=30;break;}parts=new Intl.DateTimeFormat('en',{hc:'h12',year:'numeric',month:'2-digit',day:'2-digit',hour:'numeric',minute:'numeric',timeZone:'Asia/Jerusalem'}).formatToParts(new Date()).reduce(function(acc,part){acc[part.type]=part.value;return acc;},Object.create(null));createdDate=\"\".concat(parts.day,\"/\").concat(parts.month,\"/\").concat(parts.year,\" \").concat(parts.hour,\":\").concat(parts.minute);data=new FormData();data.append('file',ConversationImage);data.append(\"upload_preset\",\"whatsApp_clone\");data.append(\"cloud_name\",\"dsrgpqnyv\");_context9.prev=20;_context9.next=23;return axios.post(\"https://api.cloudinary.com/v1_1/dsrgpqnyv/image/upload\",data);case 23:response=_context9.sent;ConversationImage=response.data.url;_context9.next=30;break;case 27:_context9.prev=27;_context9.t0=_context9[\"catch\"](20);console.log(_context9.t0);case 30:newConversation={Name:name,creatorId:sessionStorage[\"id\"],Participants:participants,Messages:[],LastMessage:{id:\"\",sender:\"\",message:\"\"},ConversationImage:ConversationImage,isGroup:isGroup,createdDate:createdDate,description:\"Add Description\"};//updateDB\n_context9.prev=31;console.log(newConversation);_context9.next=35;return axios.post(\"https://messagesapp1.herokuapp.com/api/conversations\",newConversation,config);case 35:Response=_context9.sent;if(Response.data.status===\"created\"){setSelectedConversation(Response.data.conversation);//show conversation only if messages sent\nif(Response.data.conversation.Messages.length>0)setConversations(function(prevConversations){return[].concat(_toConsumableArray(prevConversations),[Response.data.conversation]);});// }\n}_context9.next=42;break;case 39:_context9.prev=39;_context9.t1=_context9[\"catch\"](31);console.log(_context9.t1);case 42:case\"end\":return _context9.stop();}}},_callee9,null,[[20,27],[31,39]]);}));return _createConversation.apply(this,arguments);}function UpdateConversation(_x6){return _UpdateConversation.apply(this,arguments);}function _UpdateConversation(){_UpdateConversation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(updatedConversation){var updateDBConv,addCurrentParticipant,participants,response,UpdatedConversations;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:updateDBConv=_objectSpread({},updatedConversation);if(!updatedConversation.LastMessage.message.includes('left')){addCurrentParticipant={id:info.id,phone:info.phone,name:info.name,image:info.imageName};participants=[].concat(_toConsumableArray(updatedConversation.Participants),[addCurrentParticipant]);updateDBConv=_objectSpread(_objectSpread({},updateDBConv),{},{Participants:participants});}delete updateDBConv._id;_context10.prev=3;_context10.next=6;return axios.put(\"https://messagesapp1.herokuapp.com/api/conversations/\"+selectedConversation._id,updateDBConv,config);case 6:response=_context10.sent;if(response.data.status==='Updated'){UpdatedConversations=[];if(!updatedConversation.LastMessage.message.includes('left')){setSelectedConversation(updatedConversation);conversations.forEach(function(conversation){if(conversation._id===updatedConversation._id){UpdatedConversations.push(updatedConversation);}else UpdatedConversations.push(conversation);});}else{console.log(conversations);UpdatedConversations=conversations.filter(function(conversation){return conversation._id!=selectedConversation._id;});setSelectedConversation();}if(updatedConversation.LastMessage.message.includes('removed'))socket.current.emit('user-deleted',selectedConversation);else socket.current.emit('conversation-changed',selectedConversation);setConversations(UpdatedConversations);}_context10.next=13;break;case 10:_context10.prev=10;_context10.t0=_context10[\"catch\"](3);console.log(_context10.t0);case 13:case\"end\":return _context10.stop();}}},_callee10,null,[[3,10]]);}));return _UpdateConversation.apply(this,arguments);}var addMessageToConversation=useCallback(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref5){var UpdatedConv,ConversationExists,newListOfConversations,newConversation;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:UpdatedConv=_ref5.UpdatedConv;audio.play();ConversationExists=false;newListOfConversations=RefConversations.current.map(function(conversation){if(conversation._id===UpdatedConv._id){ConversationExists=true;var newConv=_objectSpread(_objectSpread({},conversation),{},{Messages:UpdatedConv.Messages,LastMessage:UpdatedConv.LastMessage});if(currentConversationRef.current){if(currentConversationRef.current._id===UpdatedConv._id)setSelectedConversation(newConv);}return newConv;}else return conversation;});if(!ConversationExists){if(!UpdatedConv.isGroup){newConversation=_objectSpread(_objectSpread({},UpdatedConv),{},{Name:UpdatedConv.Participants[0].name,ConversationImage:UpdatedConv.Participants[0].imageName});setConversations(function(prevConversations){return[].concat(_toConsumableArray(prevConversations),[newConversation]);});}else setConversations(function(prevConversations){return[].concat(_toConsumableArray(prevConversations),[UpdatedConv]);});}else setConversations(newListOfConversations);case 5:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x7){return _ref6.apply(this,arguments);};}(),[setConversations]);useEffect(function(){if(socket.current==null)return;RefConversations.current=conversations;currentConversationRef.current=selectedConversation;socket.current.on(\"receive-message\",addMessageToConversation);return function(){return socket.current.off(\"receive-message\",addMessageToConversation);};},[conversations,selectedConversation]);var updateSenderConversation=function updateSenderConversation(AddMessage){var ConversationExists=false;setSelectedConversation(AddMessage);var newListOfConcversations=conversations.map(function(conversation){if(conversation._id===AddMessage._id){ConversationExists=true;return AddMessage;}else return conversation;});if(ConversationExists){setConversations(newListOfConcversations);}else setConversations(function(prevConversations){return[].concat(_toConsumableArray(prevConversations),[AddMessage]);});};function sendMessage(text,imageFlag,imageURL,recordURL){var parts=new Intl.DateTimeFormat('en',{hc:'h12',year:'numeric',month:'2-digit',day:'2-digit',hour:'numeric',minute:'numeric',timeZone:'Asia/Jerusalem'}).formatToParts(new Date()).reduce(function(acc,part){acc[part.type]=part.value;return acc;},Object.create(null));var time=\"\".concat(parts.day,\"/\").concat(parts.month,\"/\").concat(parts.year,\"  \").concat(parts.hour,\":\").concat(parts.minute);var recordFlag=false;if(recordURL!=null)recordFlag=true;var CurrentMessage={id:info.id,name:info.name,message:text,timeSent:time,containsImage:imageFlag,containsRecord:recordFlag,recordURL:recordURL};if(imageFlag===true)CurrentMessage=_objectSpread(_objectSpread({},CurrentMessage),{},{imageURL:imageURL});var sender={id:info.id,phone:info.phone,name:info.name,image:info.imageName};var AddMessage=_objectSpread(_objectSpread({},selectedConversation),{},{Messages:[].concat(_toConsumableArray(selectedConversation.Messages),[CurrentMessage]),LastMessage:CurrentMessage});socket.current.emit(\"send-message\",{sender:sender,UpdatedConversation:AddMessage,conversationId:selectedConversation._id});updateSenderConversation(AddMessage);}return/*#__PURE__*/_jsx(ConversationsContext.Provider,{value:{sendMessage:sendMessage,conversations:conversations,createConversation:createConversation,setConversations:setConversations,setSelectedConversation:setSelectedConversation,selectedConversation:selectedConversation,currentConversationIsConnected:currentConversationIsConnected,typingFlag:typingFlag,setTypingFlag:setTypingFlag,getSearchConverastions:getSearchConverastions,showDetails:showDetails,setShowDetails:setShowDetails,UpdateConversation:UpdateConversation,removedFromGroupFlag:removedFromGroupFlag,setRemovedFromGroupFlag:setRemovedFromGroupFlag},children:children});}","map":{"version":3,"sources":["C:/Users/User/OneDrive/Desktop/whatsapp/myclient/src/contexts/conversationsprovider.js"],"names":["React","useContext","useCallback","useRef","useState","useEffect","useUser","useSocket","axios","ConversationsContext","createContext","useConversations","ConversationsProvider","id","children","contacts","info","conversations","setConversations","selectedConversation","setSelectedConversation","RefConversations","currentConversationRef","socket","ConnectedUsers","typingFlag","setTypingFlag","currentConversationIsConnected","setCurrentConversationIsConnected","config","headers","sessionStorage","showDetails","setShowDetails","removedFromGroupFlag","setRemovedFromGroupFlag","audio","Audio","fetchData","current","on","user","conversationId","_id","name","getConversations","then","res","checkIfDeleted","filter","conversation","length","isGroup","some","userId","Participants","get","response","data","LastSeen","ConversationsList","map","UpdatedConversation","Name","ConversationImage","image","console","log","getSearchConverastions","str","SearchResult","includes","createConversation","ids","groupFlag","status","message","ConversationExists","find","participants","addContactToConversation","contact","push","phone","imageName","createdDate","parts","Intl","DateTimeFormat","hc","year","month","day","hour","minute","timeZone","formatToParts","Date","reduce","acc","part","type","value","Object","create","FormData","append","post","url","newConversation","creatorId","Messages","LastMessage","sender","description","Response","prevConversations","UpdateConversation","updatedConversation","updateDBConv","addCurrentParticipant","put","UpdatedConversations","forEach","emit","addMessageToConversation","UpdatedConv","play","newListOfConversations","newConv","off","updateSenderConversation","AddMessage","newListOfConcversations","sendMessage","text","imageFlag","imageURL","recordURL","time","recordFlag","CurrentMessage","timeSent","containsImage","containsRecord"],"mappings":"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","sourcesContent":["import React, { useContext, useCallback, useRef } from \"react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useUser } from \"./userprovider\";\r\nimport { useSocket } from \"./socketprovider\";\r\nimport axios from \"axios\";\r\n\r\n\r\n\r\nconst ConversationsContext = React.createContext();\r\n\r\nexport function useConversations() {\r\n  return useContext(ConversationsContext);\r\n}\r\n\r\nexport function ConversationsProvider({ id, children }) {\r\n  const {contacts, info} = useUser();\r\n  const [conversations, setConversations] = useState([]);\r\n  const [selectedConversation, setSelectedConversation] = useState();\r\n  const RefConversations = useRef(conversations);\r\n  const currentConversationRef = useRef(selectedConversation);\r\n  const { socket, ConnectedUsers } = useSocket();\r\n  const [typingFlag,setTypingFlag] =useState('')\r\n  const [currentConversationIsConnected,setCurrentConversationIsConnected] = useState('')\r\n  const config = { headers: { \"x-access-token\": sessionStorage[\"config\"] } };\r\n  const [showDetails,setShowDetails] =useState(false)\r\n  const [removedFromGroupFlag,setRemovedFromGroupFlag] = useState(false)\r\n\r\n  const audio = new Audio('https://res.cloudinary.com/dsrgpqnyv/video/upload/v1630680168/juntos-607_qsfc7i.mp3');\r\n\r\n\r\n  useEffect(()=>{\r\n\r\n    async function fetchData() {\r\n\r\n    if(socket.current ==null ) return;\r\n    socket.current.on('user-typing',({user,conversationId})=>\r\n    {\r\n\r\n        if(selectedConversation)\r\n        {\r\n          if(selectedConversation._id === conversationId)\r\n          {\r\n             setTypingFlag(user.name)\r\n          }\r\n        }\r\n    } )\r\n\r\n    socket.current.on('update-conversation',async ()=>\r\n    {\r\n    \r\n      getConversations().then(res=> setConversations(res))\r\n    \r\n    })\r\n\r\n    socket.current.on('removed-user',async ()=>\r\n    {\r\n    \r\n      getConversations().then(res=> \r\n        {\r\n          setConversations(res)\r\n          if(selectedConversation)\r\n          {\r\n            let checkIfDeleted=res.filter(conversation=> conversation._id === selectedConversation._id)\r\n            if(checkIfDeleted.length ==0 ) \r\n               setRemovedFromGroupFlag(true)\r\n          }\r\n      })\r\n    \r\n    })\r\n  }\r\n  fetchData();\r\n  },[selectedConversation])\r\n\r\n  useEffect( ()=>\r\n  {\r\n    async function fetchData() {\r\n    if(selectedConversation)\r\n    {\r\n    if(!selectedConversation.isGroup)\r\n     {\r\n      if(ConnectedUsers.some(user=> user.userId ===selectedConversation.Participants[0].id))\r\n      {\r\n        setCurrentConversationIsConnected('')\r\n      }\r\n      else\r\n      {\r\n        let response = await axios.get(\"https://messagesapp1.herokuapp.com/api/logIn/\"+ selectedConversation.Participants[0].id,config)\r\n        setCurrentConversationIsConnected(response.data.LastSeen)\r\n      }\r\n     }\r\n    }\r\n  }\r\n  fetchData();\r\n\r\n  },[ConnectedUsers,selectedConversation])\r\n\r\n  useEffect(() =>\r\n  {\r\n    async function fetchData() {\r\n     getConversations().then(res=> setConversations(res))\r\n    }\r\n    fetchData();\r\n    \r\n  }, []);\r\n\r\n  async function getConversations()\r\n  {\r\n    try{\r\n       let response = await axios.get(\"https://messagesapp1.herokuapp.com/api/conversations/UserConversations/\" +sessionStorage[\"id\"],config);\r\n       let ConversationsList = response.data.map((conversation) =>\r\n       {\r\n         let UpdatedConversation= conversation\r\n         if (!conversation.Participants.isGroup && conversation.Name === sessionStorage[\"name\"])\r\n            UpdatedConversation = { ...UpdatedConversation,Name: conversation.Participants[0].name,ConversationImage:conversation.Participants[0].image}\r\n\r\n         if(selectedConversation)\r\n         {\r\n           if(selectedConversation._id === UpdatedConversation._id)\r\n              setSelectedConversation(UpdatedConversation)\r\n         }\r\n          \r\n         return UpdatedConversation;\r\n       })\r\n\r\n      return ConversationsList \r\n    } catch (err) {console.log(err);}\r\n  }\r\n\r\n\r\n\r\n\r\n  async function getSearchConverastions(str)\r\n  {\r\n\r\n        getConversations().then(res=>\r\n        {\r\n\r\n         let SearchResult = res.filter(conversation=> \r\n            conversation.Name.includes(str) ===true\r\n          )\r\n    \r\n          setConversations(SearchResult)\r\n        })\r\n  }\r\n        \r\n\r\n\r\n  async function createConversation(ids, name, image,groupFlag) {\r\n    let ConversationImage = image;\r\n    let isGroup = groupFlag;\r\n\r\n\r\n    //no participants chosen\r\n    if (ids.length === 0) {\r\n      return {status:'error',message:'no participants choosen'};\r\n    }\r\n\r\n    //check if conversation already exists and it's not a group\r\n    let ConversationExists = null;\r\n    if (ids.length === 1 && !isGroup) {\r\n      ConversationExists = conversations.find(\r\n        (conversation) => conversation.Name === name\r\n      );\r\n    }\r\n\r\n    if (ConversationExists) setSelectedConversation(ConversationExists);\r\n\r\n    //create new conversation\r\n    else {\r\n\r\n      //get conversation participants\r\n      const participants = ids.map((id) => {\r\n        let addContactToConversation = contacts.filter(\r\n          (contact) => id === contact.id\r\n        );\r\n        return addContactToConversation[0];\r\n      });\r\n\r\n\r\n      //add creator to participants\r\n      participants.push({\r\n        id: info.id,\r\n        name: info.name,\r\n        phone: info.phone,\r\n        imageName: info.imageName,\r\n        LastSeen: info.LastSeen\r\n      });\r\n\r\n      let createdDate=''\r\n\r\n      //if group\r\n      \r\n      if (isGroup) {\r\n\r\n\r\n        let parts = new Intl.DateTimeFormat('en', {\r\n          hc: 'h12',\r\n          year: 'numeric',\r\n          month: '2-digit',\r\n          day: '2-digit',\r\n          hour: 'numeric',\r\n          minute: 'numeric',\r\n          timeZone:'Asia/Jerusalem'})\r\n        .formatToParts(new Date())\r\n        .reduce((acc, part) => {\r\n          acc[part.type] = part.value;\r\n          return acc;\r\n        }, Object.create(null));\r\n\r\n       \r\n    \r\n        createdDate= `${parts.day}/${parts.month}/${parts.year} ${parts.hour}:${parts.minute}`;\r\n\r\n        const data = new FormData()\r\n        data.append('file',ConversationImage)\r\n        data.append(\"upload_preset\",\"whatsApp_clone\")\r\n        data.append(\"cloud_name\",\"dsrgpqnyv\")\r\n        try{\r\n        let response = await axios.post(\"https://api.cloudinary.com/v1_1/dsrgpqnyv/image/upload\",data)\r\n        ConversationImage = response.data.url;\r\n\r\n        }catch(err){console.log(err)}\r\n   \r\n      }\r\n \r\n    \r\n      let newConversation = {\r\n        Name: name,\r\n        creatorId: sessionStorage[\"id\"],\r\n        Participants: participants,\r\n        Messages: [],\r\n        LastMessage: { id: \"\", sender: \"\", message: \"\" },\r\n        ConversationImage: ConversationImage,\r\n        isGroup:isGroup,\r\n        createdDate:createdDate,\r\n        description: \"Add Description\",\r\n      };\r\n\r\n      //updateDB\r\n      try {\r\n        console.log(newConversation)\r\n        let Response = await axios.post(\r\n          \"https://messagesapp1.herokuapp.com/api/conversations\",\r\n          newConversation,\r\n          config\r\n        );\r\n\r\n        if (Response.data.status === \"created\") {\r\n          setSelectedConversation(Response.data.conversation);\r\n\r\n          //show conversation only if messages sent\r\n          if (Response.data.conversation.Messages.length > 0)\r\n            setConversations((prevConversations) => {\r\n              return [...prevConversations, Response.data.conversation];\r\n            });\r\n          // }\r\n        }\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    }\r\n  }\r\n\r\n  async function UpdateConversation(updatedConversation)\r\n  {\r\n\r\n    let updateDBConv={...updatedConversation}\r\n    if(!(updatedConversation.LastMessage.message.includes('left')))\r\n    {\r\n      let addCurrentParticipant= {id: info.id,phone: info.phone,name: info.name,image: info.imageName,}\r\n      let participants=[...updatedConversation.Participants,addCurrentParticipant]\r\n      updateDBConv={...updateDBConv,Participants:participants}\r\n    }\r\n    delete updateDBConv._id\r\n\r\n\r\n      try{\r\n        let response=await axios.put(\"https://messagesapp1.herokuapp.com/api/conversations/\"+ selectedConversation._id,updateDBConv,config)\r\n        if(response.data.status==='Updated')\r\n        {\r\n\r\n          let UpdatedConversations=[]\r\n         if(!(updatedConversation.LastMessage.message.includes('left')))\r\n         {\r\n\r\n          setSelectedConversation(updatedConversation)\r\n        \r\n           conversations.forEach(conversation=>\r\n            {\r\n              \r\n              if(conversation._id===updatedConversation._id)\r\n              {\r\n                   \r\n                  UpdatedConversations.push(updatedConversation)\r\n              }\r\n              else UpdatedConversations.push(conversation)\r\n            })\r\n          }\r\n          else\r\n          {\r\n            console.log(conversations)\r\n             UpdatedConversations=conversations.filter(conversation=> conversation._id != selectedConversation._id)\r\n             setSelectedConversation()\r\n          }\r\n\r\n          if(updatedConversation.LastMessage.message.includes('removed'))\r\n              socket.current.emit('user-deleted',selectedConversation)\r\n          else\r\n              socket.current.emit('conversation-changed',selectedConversation)\r\n\r\n\r\n\r\n\r\n            setConversations(UpdatedConversations)\r\n          \r\n            \r\n        }\r\n      }catch(err){console.log(err)}\r\n  }\r\n\r\n \r\n\r\n  const addMessageToConversation = useCallback(async ({ UpdatedConv }) =>\r\n   {\r\n\r\n      audio.play()\r\n\r\n      let ConversationExists = false;\r\n      let newListOfConversations = RefConversations.current.map((conversation) =>{\r\n          if (conversation._id === UpdatedConv._id) {\r\n            ConversationExists = true;\r\n            let newConv = { ...conversation,\r\n              Messages: UpdatedConv.Messages,\r\n              LastMessage: UpdatedConv.LastMessage,};\r\n            if (currentConversationRef.current) {\r\n              if (currentConversationRef.current._id === UpdatedConv._id)\r\n                setSelectedConversation(newConv);\r\n            }\r\n\r\n            return newConv;\r\n          } else return conversation;\r\n        }\r\n      );\r\n\r\n\r\n      if (!ConversationExists) {\r\n        if (!UpdatedConv.isGroup)\r\n         {\r\n           let newConversation = { ...UpdatedConv,\r\n            Name: UpdatedConv.Participants[0].name,\r\n            ConversationImage: UpdatedConv.Participants[0].imageName,\r\n          };\r\n          setConversations((prevConversations) => [...prevConversations, newConversation ]);\r\n        } else\r\n          setConversations((prevConversations) => [...prevConversations,UpdatedConv]);\r\n      } else setConversations(newListOfConversations);\r\n    },[setConversations]);\r\n\r\n  useEffect(() => {\r\n    if (socket.current == null) return;\r\n    \r\n    RefConversations.current = conversations;\r\n    currentConversationRef.current = selectedConversation;\r\n    socket.current.on(\"receive-message\", addMessageToConversation);\r\n\r\n    return () =>\r\n      socket.current.off(\"receive-message\", addMessageToConversation);\r\n  }, [conversations, selectedConversation]);\r\n\r\n\r\n  const updateSenderConversation = (AddMessage) => {\r\n    let ConversationExists = false;\r\n    setSelectedConversation(AddMessage);\r\n\r\n    let newListOfConcversations = conversations.map((conversation) => {\r\n      if (conversation._id === AddMessage._id) {\r\n        ConversationExists = true;\r\n        return AddMessage;\r\n      } else return conversation;\r\n    });\r\n\r\n    if (ConversationExists) {\r\n      setConversations(newListOfConcversations);\r\n    } else\r\n      setConversations((prevConversations) => [\r\n        ...prevConversations,\r\n        AddMessage,\r\n      ]);\r\n  };\r\n\r\n\r\n  function sendMessage(text,imageFlag,imageURL,recordURL) {\r\n\r\n\r\n      let parts = new Intl.DateTimeFormat('en', {\r\n      hc: 'h12',\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: 'numeric',\r\n      minute: 'numeric',\r\n      timeZone:'Asia/Jerusalem'})\r\n    .formatToParts(new Date())\r\n    .reduce((acc, part) => {\r\n      acc[part.type] = part.value;\r\n      return acc;\r\n    }, Object.create(null));\r\n\r\n    let time = `${parts.day}/${parts.month}/${parts.year}  ${parts.hour}:${parts.minute}`;\r\n\r\n    let recordFlag= false\r\n\r\n    if(recordURL!=null)\r\n       recordFlag=true\r\n    \r\n    let CurrentMessage = { id: info.id, name: info.name, message: text  ,timeSent: time ,containsImage: imageFlag,containsRecord:recordFlag,recordURL:recordURL};\r\n    if(imageFlag ===true)\r\n       CurrentMessage= {...CurrentMessage,imageURL:imageURL}\r\n    \r\n    let sender = {\r\n      id: info.id,\r\n      phone: info.phone,\r\n      name: info.name,\r\n      image: info.imageName,\r\n    };\r\n    let AddMessage = {\r\n      ...selectedConversation,\r\n      Messages: [...selectedConversation.Messages, CurrentMessage],\r\n      LastMessage: CurrentMessage,\r\n    };\r\n    socket.current.emit(\"send-message\", {\r\n      sender: sender,\r\n      UpdatedConversation: AddMessage,\r\n      conversationId: selectedConversation._id,\r\n    });\r\n\r\n    updateSenderConversation(AddMessage);\r\n  }\r\n\r\n  return (\r\n    <ConversationsContext.Provider\r\n      value={{\r\n        sendMessage,\r\n        conversations,\r\n        createConversation,\r\n        setConversations,\r\n        setSelectedConversation,\r\n        selectedConversation,\r\n        currentConversationIsConnected,\r\n        typingFlag,\r\n        setTypingFlag,\r\n        getSearchConverastions,\r\n        showDetails,\r\n        setShowDetails,\r\n        UpdateConversation,\r\n        removedFromGroupFlag,\r\n        setRemovedFromGroupFlag\r\n      \r\n      }}\r\n    >\r\n      {children}\r\n    </ConversationsContext.Provider>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}